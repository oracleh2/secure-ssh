# Secure-SSH

[![Rust](https://img.shields.io/badge/Rust-1.75%2B-orange.svg)](https://www.rust-lang.org/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/Platform-Linux%20%7C%20Windows%20%7C%20macOS-lightgrey.svg)]()

**Безопасный SSH-клиент с защитой по типу аппаратного токена**

[English version](README.md)

---

## Обзор

Secure-SSH — это консольный SSH-клиент, разработанный для работы подобно аппаратному токену безопасности. Он хранит ваш SSH-ключ в зашифрованном виде на USB-накопителе, требуя мастер-пароль для расшифровки и использования. При извлечении USB-накопителя все активные соединения автоматически завершаются.

### Ключевые особенности

- **Шифрование военного класса**: Argon2id + ChaCha20-Poly1305
- **SSH-ключи Ed25519**: Современные, безопасные и быстрые
- **USB watchdog**: Автоотключение при извлечении USB-накопителя
- **Защита памяти**: Ключи обнуляются при освобождении, память блокируется от свопинга
- **Кроссплатформенность**: Linux, Windows, macOS (x86_64 и ARM64)
- **Портативность**: Один бинарный файл, установка не требуется
- **Без GUI**: Командная строка для максимальной безопасности

---

## Содержание

- [Архитектура безопасности](#архитектура-безопасности)
- [Установка](#установка)
- [Сборка из исходников](#сборка-из-исходников)
- [Использование](#использование)
- [Справочник команд](#справочник-команд)
- [Принцип работы](#принцип-работы)
- [Вопросы безопасности](#вопросы-безопасности)
- [Лицензия](#лицензия)

---

## Архитектура безопасности

### Стек шифрования

| Уровень | Алгоритм | Назначение |
|---------|----------|------------|
| Вывод ключа | **Argon2id** | Пароль → Ключ шифрования |
| Симметричное шифрование | **ChaCha20-Poly1305** | Шифрование приватного ключа и конфигов |
| SSH-ключи | **Ed25519** | Аутентификация на серверах |

### Параметры Argon2id (рекомендации OWASP)

- Память: 64 МБ
- Итерации: 3
- Параллелизм: 4 потока
- Соль: 256-битная случайная

### Защита памяти

- Приватные ключи хранятся в обёртке `SecureBytes`
- Автоматическое обнуление при освобождении через крейт `zeroize`
- Блокировка памяти через `mlock()` для предотвращения свопинга
- Никакого ключевого материала в логах или отладочном выводе

---

## Установка

### Готовые бинарники

Скачайте последний релиз для вашей платформы:

| Платформа | Бинарник |
|-----------|----------|
| Linux x86_64 | `secure-ssh` |
| Windows x86_64 | `secure-ssh.exe` |
| macOS x86_64 | `secure-ssh` |
| macOS ARM64 (Apple Silicon) | `secure-ssh` |

### Из исходников

Смотрите раздел [Сборка из исходников](#сборка-из-исходников).

---

## Сборка из исходников

### Требования

1. **Rust toolchain** (1.75 или новее)

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env
```

2. **Для кросс-компиляции (опционально)**

```bash
# Windows target
sudo apt install mingw-w64
rustup target add x86_64-pc-windows-gnu

# macOS targets (требуется Zig)
cargo install cargo-zigbuild
rustup target add x86_64-apple-darwin aarch64-apple-darwin

# Установка Zig (для кросс-компиляции под macOS)
# Скачайте с https://ziglang.org/download/
```

### Команды сборки

#### Linux (нативная сборка)

```bash
git clone https://github.com/oracleh2/secure-ssh.git
cd secure-ssh
cargo build --release
```

Расположение бинарника: `target/release/secure-ssh`

#### Windows (кросс-компиляция из Linux)

```bash
cargo build --release --target x86_64-pc-windows-gnu
```

Расположение бинарника: `target/x86_64-pc-windows-gnu/release/secure-ssh.exe`

#### macOS (кросс-компиляция из Linux)

```bash
# Intel Mac
cargo zigbuild --release --target x86_64-apple-darwin

# Apple Silicon
cargo zigbuild --release --target aarch64-apple-darwin
```

Расположение бинарников:
- `target/x86_64-apple-darwin/release/secure-ssh`
- `target/aarch64-apple-darwin/release/secure-ssh`

#### Сборка для всех платформ

```bash
./build-all.sh
```

### Оптимизация сборки

Release-сборка включает:
- LTO (Link-Time Optimization)
- Единый codegen unit
- Удаление символов (strip)
- Panic = abort

Размер итогового бинарника: ~2 МБ

---

## Использование

### Быстрый старт

1. **Скопируйте бинарник на USB-накопитель**

```bash
cp target/release/secure-ssh /media/your-usb-drive/
cd /media/your-usb-drive/
```

2. **Инициализируйте с мастер-паролем**

```bash
./secure-ssh init
```

Это создаст:
- Новую пару ключей Ed25519
- Зашифрует приватный ключ вашим мастер-паролем
- Создаст файл-маркер для определения USB
- Отобразит ваш публичный ключ

3. **Добавьте публичный ключ на сервер**

```bash
./secure-ssh pubkey
# Скопируйте вывод в ~/.ssh/authorized_keys на вашем сервере
```

4. **Добавьте конфигурацию сервера**

```bash
./secure-ssh server add
```

5. **Подключитесь к серверу**

```bash
./secure-ssh connect
# или
./secure-ssh connect myserver
```

---

## Справочник команд

### `secure-ssh init`

Инициализация secure-ssh с новым мастер-паролем и SSH-ключом.

```bash
./secure-ssh init
```

**Что делает:**
- Генерирует новую пару ключей Ed25519
- Запрашивает мастер-пароль (минимум 12 символов)
- Шифрует приватный ключ с использованием Argon2id + ChaCha20-Poly1305
- Сохраняет зашифрованные данные в `.secure-ssh-data/`
- Создаёт файл-маркер для определения USB

### `secure-ssh pubkey`

Отображение публичного SSH-ключа в формате OpenSSH.

```bash
./secure-ssh pubkey
```

**Пример вывода:**
```
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx secure-ssh-key
```

### `secure-ssh server add`

Добавление новой конфигурации сервера.

```bash
./secure-ssh server add
```

**Запрашивает:**
- Имя сервера (алиас)
- Хост/IP-адрес
- Порт (по умолчанию: 22)
- Имя пользователя
- Описание (опционально)

### `secure-ssh server list`

Показать все настроенные серверы.

```bash
./secure-ssh server list
```

### `secure-ssh server remove <имя>`

Удаление конфигурации сервера.

```bash
./secure-ssh server remove myserver
```

### `secure-ssh connect [имя]`

Подключение к настроенному серверу.

```bash
# Если настроен только один сервер:
./secure-ssh connect

# Или укажите имя сервера:
./secure-ssh connect myserver
```

**Возможности:**
- Интерактивная терминальная сессия
- Автоматическое определение изменения размера терминала
- USB watchdog активен (отключится при извлечении USB)

### `secure-ssh change-pass`

Смена мастер-пароля.

```bash
./secure-ssh change-pass
```

**Что делает:**
- Запрашивает текущий пароль
- Запрашивает новый пароль (с подтверждением)
- Перешифровывает все данные новым паролем

---

## Принцип работы

### Структура файлов

При инициализации secure-ssh создаёт следующую структуру в своей директории:

```
/ваш-usb-накопитель/
├── secure-ssh              # Бинарник
├── .secure-ssh-data/       # Директория с зашифрованными данными
│   ├── key.enc             # Зашифрованный приватный ключ
│   ├── key.pub             # Публичный ключ (незашифрованный)
│   └── servers.enc         # Зашифрованные конфиги серверов
└── .secure-ssh-marker      # Маркер для определения USB
```

### Процесс шифрования

1. **Пароль → Ключ**: Argon2id выводит 256-битный ключ из вашего пароля
2. **Случайная соль**: Каждое шифрование использует уникальную случайную соль
3. **Случайный nonce**: ChaCha20-Poly1305 использует уникальный nonce для каждого шифрования
4. **Аутентификация**: MAC Poly1305 обеспечивает целостность данных

### USB Watchdog

Watchdog отслеживает:
1. Файл-маркер (`.secure-ssh-marker`)
2. Если маркер не найден — проверяет директорию исполняемого файла

При извлечении USB-накопителя:
- Активные SSH-сессии завершаются
- Приватный ключ обнуляется в памяти
- Программа корректно завершается

---

## Вопросы безопасности

### Сильные стороны

- **Memory-hard KDF**: Argon2id противостоит GPU/ASIC атакам
- **AEAD шифрование**: ChaCha20-Poly1305 обеспечивает конфиденциальность + целостность
- **Ed25519**: Современная эллиптическая кривая, устойчивая к атакам по времени
- **Защита памяти**: Ключи обнуляются при освобождении, защищены от свопинга
- **Без кэширования ключей**: Пароль требуется для каждой сессии

### Ограничения

- **Физический доступ**: Если кто-то имеет ваш USB и пароль — имеет доступ
- **Захват экрана**: Вывод терминала виден на экране
- **Cold boot атаки**: Теоретически возможны на замороженной RAM
- **Вредоносное ПО**: Если хост-система скомпрометирована, кейлоггеры могут перехватить пароль

### Лучшие практики

1. Используйте надёжный мастер-пароль (рекомендуется 16+ символов)
2. Храните USB-накопитель в безопасности
3. Извлекайте USB-накопитель после использования
4. Проверяйте отпечатки серверов при первом подключении
5. Поддерживайте бинарник в актуальном состоянии

---

## Зависимости

| Крейт | Версия | Назначение |
|-------|--------|------------|
| `argon2` | 0.5 | Хэширование пароля |
| `chacha20poly1305` | 0.10 | Аутентифицированное шифрование |
| `ed25519-dalek` | 2.2 | Генерация SSH-ключей |
| `russh` | 0.45 | Реализация SSH-клиента |
| `tokio` | 1.x | Асинхронный runtime |
| `zeroize` | 1.8 | Безопасное обнуление памяти |
| `clap` | 4.x | Парсинг аргументов CLI |
| `crossterm` | 0.28 | Работа с терминалом |

Полный список в `Cargo.toml`.

---

## Лицензия

Этот проект лицензирован под лицензией MIT — смотрите файл [LICENSE](LICENSE) для деталей.

---

## Благодарности

- [RustCrypto](https://github.com/RustCrypto) за отличные криптографические библиотеки
- [russh](https://github.com/warp-tech/russh) за реализацию SSH
- Сообществу Rust за то, что делают разработку безопасного ПО доступной

---

## Автор

Создано с заботой о безопасности.

**Репозиторий проекта**: https://github.com/oracleh2/secure-ssh
